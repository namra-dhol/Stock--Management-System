@model List<InvoiceModel>
@{
    ViewData["Title"] = "Invoice List";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Invoice Management</h2>
    <div class="d-flex gap-2">
        <a asp-controller="Invoice" asp-action="AddEdit" class="btn btn-primary">
            <i class="bi bi-plus-circle me-2"></i>Create Invoice
        </a>
        <a asp-controller="Sale" asp-action="SaleList" class="btn btn-outline-primary">
            <i class="bi bi-receipt me-2"></i>Generate from Sales
        </a>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Invoice #</th>
                        <th>Invoice Date</th>
                        <th>Due Date</th>
                        <th>Customer</th>
                        <th>Sub Total</th>
                        <th>Discount</th>
                        <th>Tax</th>
                        <th>Total Amount</th>
                        <th>Status</th>
                        <th style="width: 200px;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null && Model.Any())
                    {
                        foreach (var item in Model)
                        {
                            <tr>
                                <td>@item.InvoiceNumber</td>
                                <td>@item.InvoiceDate?.ToString("dd/MM/yyyy")</td>
                                <td>@item.DueDate?.ToString("dd/MM/yyyy")</td>
                                <td>@item.Customer?.CustomerName</td>
                                <td>₹@item.SubTotal?.ToString("N2")</td>
                                <td>
                                    @if (item.DiscountAmount > 0)
                                    {
                                        <span class="text-success">₹@item.DiscountAmount?.ToString("N2")</span>
                                        <small class="text-muted">(@item.DiscountPercentage%)</small>
                                    }
                                    else
                                    {
                                        <span class="text-muted">-</span>
                                    }
                                </td>
                                <td>
                                    @if (item.TaxAmount > 0)
                                    {
                                        <span>₹@item.TaxAmount?.ToString("N2")</span>
                                        <small class="text-muted">(@item.TaxPercentage%)</small>
                                    }
                                    else
                                    {
                                        <span class="text-muted">-</span>
                                    }
                                </td>
                                <td><strong>₹@item.TotalAmount?.ToString("N2")</strong></td>
                                <td>
                                    <span class="badge @(item.Status == "Paid" ? "bg-success" : item.Status == "Overdue" ? "bg-danger" : "bg-warning")">
                                        @item.Status
                                    </span>
                                </td>
                                <td>
                                    <div class="btn-group" role="group">
                                        <a asp-action="Print" asp-route-id="@item.InvoiceId" class="btn btn-sm btn-info" target="_blank">
                                            <i class="bi bi-printer"></i> Print
                                        </a>
                                        <a asp-action="AddEdit" asp-route-id="@item.InvoiceId" class="btn btn-sm btn-primary">
                                            <i class="bi bi-pencil"></i> Edit
                                        </a>
                                        <a asp-action="Delete" asp-route-id="@item.InvoiceId" class="btn btn-sm btn-danger"
                                           onclick="return confirm('Are you sure you want to delete this invoice?');">
                                            <i class="bi bi-trash"></i> Delete
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="10" class="text-center text-muted">No Invoices found.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Summary Cards -->
<div class="row mt-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <h6>Total Invoices</h6>
                <h4>@Model.Count()</h4>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <h6>Paid Invoices</h6>
                <h4>@Model.Count(i => i.Status == "Paid")</h4>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <h6>Pending Invoices</h6>
                <h4>@Model.Count(i => i.Status == "Pending")</h4>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-danger text-white">
            <div class="card-body">
                <h6>Overdue Invoices</h6>
                <h4>@Model.Count(i => i.Status == "Overdue")</h4>
            </div>
        </div>
    </div>
</div>
